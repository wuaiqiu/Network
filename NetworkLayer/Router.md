												# Router #


1.转发分组：对一条路由信息（目的网络地址，下一跳转地址）

(1) 从数据报中提取目的主机的IP地址D，得出目的网络地址N

(2) 如果N是与此路由器直接相连的某个网络地址，则直接交付，否则为间接交付，执行(3)

(3) 若路由表中有目的地址D的特定主机路由，则把数据报传送给路由表的下一跳路由器；否则,执行(4)

(4) 若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器，否则，执行(5)

(5) 若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由，否则，执行(6)

(6)报告转发分组出错。

![](http://i.imgur.com/iWabAt5.png)

2.路由选择协议

 A. 路由选择协议分类
(1) 内部网管协议IGP：在一个自治系统(AS)内部使用的路由选择协议，如RIP和OSPE协议
(2) 外部网关协议EGP：在一个自治系统的边界，用来将路由选择信息传递给下一个自治系统的协议。如BGP-4

 ![](http://i.imgur.com/4kJi5XB.png)
  B. 内部网关协议RIP：不断更新路由表，使得从每一个路由到每一个目的路由都时最短的。
(1) 一种分布式的基于距离向量的路由选择协议。
(2) 协议里的“距离”也称谓“跳数”，每经过一个路由加+1
(3) 协议特点：
a.仅和相邻路由器交换信息
b.交换的信息是当前本路由器所知道的全部信息(信息包括我到本AS中
个网络的最短距离，以及到每个网络经过的下一跳路由器)。
c.按固定的时间间隔交换路由信息。
d.允许一条路径最多包含15个路由器,可见RIP只适应与小型互联网
 
 C.内部网关协议OSPF
(1) 使用分布式的链路状态协议，开放最短路径优先（Open Shortest Path First）,使用Dijkstra的最短路径算法SPF
(2) 三个要点(和RIP不同)
a.采用洪泛法，路由器通过所有输出端口向所有相邻的路由发送信息
b.发送的信息时与本路由器相邻的所有路由器的链路状态
c.只有当链路状态发生变化时，路由器才会再次采用洪泛法发送信息 （与RIP不同）
(3) 特点：
a.建立了一个链路状态数据库，全网的拓扑结构图
b.能较快的更新数据库，更新过程收敛很快
c.为了使OSPF用于大规模的网络，它将一个自治系统划分为多个区域
这样利用洪泛法交换链路状态信息的范围就局限于每一个区域，减少了网络上的通信量
d.OSPF不用UDP而是直接用IP数据报发送
e.OSPF对于不同类型的业务可计算出不同的路由
f.多路径间的负载平衡：在代价相同的多条路径上分配通信量
g.OSPF支持可变长度的子网划分和无分类的编址CIDR

 D.外部网关协议BGP：力求寻找一条能到达目的网络且比较好的路由，而并非寻找一个最佳路由
(1) 采用路径向量路由选择协议
(2) 每一个AS都需要一个BGP发言人，这些发言人之间交换路由信息，构建AS连通图，它是树形结构，不存在回路

